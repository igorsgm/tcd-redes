!function(a,b){"use strict";window.ImageManager={initialize:function(){var c=this.getUriObject(window.self.location.href),d=this.getQueryObject(c.query);this.editor=decodeURIComponent(d.e_name),this.fields={url:b.getElementById("f_url"),alt:b.getElementById("f_alt"),align:b.getElementById("f_align"),title:b.getElementById("f_title"),credit:b.getElementById("f_credit"),caption:b.getElementById("f_caption"),c_class:b.getElementById("f_caption_class")},this.folderlist=b.getElementById("folderlist"),this.frame=window.frames.imageframe,this.frameurl=this.frame.location.href,a("#imageframe").on("load",function(){ImageManager.onloadimageview()}),a("#upbutton").off("click").on("click",function(){ImageManager.upFolder()})},onloadimageview:function(){var e,f,b=this.getImageFolder(),c=a("#uploadForm"),d="";this.frameurl=this.frame.location.href,this.setFolder(b),e=this.getUriObject(c.attr("action")),f=this.getQueryObject(e.query),f.folder=b,e.query=a.param(f),void 0!==e.port&&80!=e.port&&(d=":"+e.port),c.attr("action",e.scheme+"://"+e.domain+d+e.path+"?"+e.query)},getImageFolder:function(){return this.getQueryObject(this.frame.location.search.substring(1)).folder},onok:function(){var a="",b=[],c="",d="",f="",g="",h=this.fields.url.value,i=this.fields.alt.value,j=this.fields.align.value,k=this.fields.title.value,l=this.fields.credit.value,m=this.fields.caption.value,n=this.fields.c_class.value;return h&&(b.push('alt="'+i+'"'),j&&!m&&b.push('class="pull-'+j+'"'),k&&b.push('title="'+k+'"'),a='<img src="'+h+'" '+b.join(" ")+"/>",(m||l)&&(l&&(g=' aria-label="'+l+'" '),j&&(c=' class="pull-'+j+'"'),n&&(d=' class="'+n+'"'),f=' style="width:'+this.getImageWidth(juri_base+h)+'px;"',a="<figure"+g+c+f+">"+a+"<figcaption"+d+">"+m+"</figcaption></figure>")),window.parent.jInsertEditorText(a,this.editor),!0},onfilepost:function(a,b,c){var d=document.getElementById("upload-file"),e=jQuery("#f_text").val(),f=new RegExp("fakepath"),g=f.test(a);1!=d.files.length||void 0!==e&&""!=e||1==b||(sessionStorage.img_path=""!=c?g?a.replace(/C:\\fakepath\\*/g,"images/"+c+"/"):"images/"+c+"/"+a:g?a.replace(/C:\\fakepath\\*/g,"images/"):"images/"+a)},getImageWidth:function(a){var b=new Image;return b.src=a,b.width},setFolder:function(b,c,d){for(var e=0,f=this.folderlist.length;e<f;e++)if(b==this.folderlist.options[e].value){this.folderlist.selectedIndex=e,a(this.folderlist).trigger("liszt:updated").trigger("chosen:updated");break}(c||d)&&this.setFrameUrl(b,c,d)},upFolder:function(){var b,a=this.folderlist.value.split("/");a.pop(),b=a.join("/"),this.setFolder(b),this.setFrameUrl(b)},populateFields:function(b){a("#f_url").val(image_base_path+b)},showMessage:function(b){var c=a("#message");c.find(">:first-child").remove(),c.append(b),a("#messages").css("display","block")},refreshFrame:function(){this.frame.location.href=this.frameurl},setFrameUrl:function(b,c,d){var e={option:"com_media",view:"imagesList",tmpl:"component",asset:c,author:d};this.frameurl="index.php?"+a.param(e)+"&folder="+b,this.frame.location.href=this.frameurl},getQueryObject:function(b){var c={};return a.each((b||"").split(/[&;]/),function(a,b){var d=b.split("=");c[d[0]]=2==d.length?d[1]:null}),c},getUriObject:function(b){var c={},d=b.match(/^(?:([^:\/?#.]+):)?(?:\/\/)?(([^:\/?#]*)(?::(\d*))?)((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[\?#]|$)))*\/?)?([^?#\/]*))?(?:\?([^#]*))?(?:#(.*))?/);return a.each(["uri","scheme","authority","domain","port","path","directory","file","query","fragment"],function(a,b){c[b]=d&&d[a]?d[a]:""}),c}},a(function(){window.ImageManager.initialize()})}(jQuery,document);